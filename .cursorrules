# Cursor IDE Rules for AI Pair Orchestrator Pro - VThink 1.0

## ğŸš¨ **REGLAS ABSOLUTAS - NUNCA VIOLAR**

### **ğŸ“¦ DEPENDENCY MANAGEMENT RULES (OBLIGATORIAS):**
```json
// âœ… MANDATORY: Use exact versions only
"next": "15.3.4"  // âœ… YES - exact version
"@radix-ui/react-tooltip": "1.0.7"  // âœ… YES - exact version

// âŒ FORBIDDEN: Never use caret versions
"next": "^15.3.4"  // âŒ NO - causes instability
"@radix-ui/react-tooltip": "^1.0.7"  // âŒ NO - causes instability
```

### **ğŸ—ï¸ MONOREPO RULES (OBLIGATORIAS):**
```bash
# âœ… MANDATORY: Install only in root for shared dependencies
npm install clsx tailwind-merge --save  # âœ… ONLY in root

# âŒ FORBIDDEN: Never install in both places
npm install clsx --save  # âŒ NO in apps/dashboard
npm install clsx --save  # âŒ NO in root (duplicate)
```

### **ğŸ›¡ï¸ STABILITY RULES (OBLIGATORIAS):**
```typescript
// âœ… MANDATORY: Never change working code
// If it works, DON'T TOUCH IT

// âŒ FORBIDDEN: Don't "improve" working code
// Don't update versions "just because"
// Don't add dependencies "to fix errors"
```

### **ğŸ“‹ MANDATORY CHECKLIST BEFORE ANY CHANGE:**
1. âœ… **READ** existing rules in README.md lines 47-60
2. âœ… **VALIDATE** if change is really necessary
3. âœ… **USE** exact versions (no ^)
4. âœ… **INSTALL** only where appropriate
5. âœ… **DON'T TOUCH** working code

## ğŸ¤– **CURSOR INTERACTIVE MODE CONFIGURATION**

### **Agent Settings (Cursor Settings - Ctrl+,):**
```json
{
  "agent.enabled": true,
  "agent.mode": "interactive",
  "agent.autoComplete": true,
  "agent.autoExecute": true,
  "agent.confirmationRequired": false,
  "agent.contextWindow": "large",
  "agent.inlineChat.enabled": true,
  "agent.inlineChat.showToolbar": true,
  "agent.inlineChat.autoExecute": true,
  "agent.suggestions.enabled": true,
  "agent.suggestions.showInline": true,
  "agent.quickAction.autoExecute": true,
  "agent.telemetry": false,
  "agent.experimentalFeatures": true
}
```

### **Keyboard Shortcuts for Interactive Mode:**
```json
{
  "keybindings": [
    { "key": "ctrl+shift+l", "command": "agent.chat" },
    { "key": "ctrl+k", "command": "agent.quickAction" },
    { "key": "ctrl+shift+p", "command": "workbench.action.showCommands" },
    { "key": "ctrl+shift+i", "command": "agent.inlineChat" },
    { "key": "ctrl+shift+a", "command": "agent.analyze" }
  ]
}
```

### **Interactive Mode Behaviors:**
- **Auto-complete**: Always suggest context-aware completions
- **Inline Chat**: Enable for quick questions without opening chat panel
- **Context Awareness**: Maintain session context across file switches
- **Multi-file Operations**: Support operations across multiple files
- **Real-time Suggestions**: Provide suggestions as you type
- **Error Detection**: Highlight potential issues before compilation

### **Session Context Management:**
```typescript
// âœ… Interactive session context
const interactiveContext = {
  currentFile: activeFile,
  recentFiles: lastModifiedFiles,
  currentTask: activeTask,
  userIntent: detectedIntent,
  projectContext: {
    methodology: 'VThink 1.0',
    compliance: 'CMMI-ML3',
    architecture: 'Multi-tenant SaaS'
  }
};
```

### **Agent Response Patterns:**
- **Proactive Suggestions**: Suggest improvements without being asked
- **Context-Aware Help**: Provide help based on current file and task
- **Multi-step Solutions**: Break complex tasks into manageable steps
- **Code Examples**: Always provide working code examples
- **Explanation First**: Explain the "why" before the "how"

### **Performance Optimizations:**
- **Lazy Loading**: Load context only when needed
- **Caching**: Cache frequently accessed project information
- **Parallel Processing**: Handle multiple requests simultaneously
- **Memory Management**: Clear context when switching major tasks

### **AI Model Configuration:**
```json
{
  "agent.model": "claude-3.5-sonnet",
  "agent.temperature": 0.1,
  "agent.maxTokens": 4000,
  "agent.topP": 0.9,
  "agent.frequencyPenalty": 0.0,
  "agent.presencePenalty": 0.0
}
```

### **Error Handling Patterns:**
```typescript
// âœ… Comprehensive error handling
try {
  const result = await riskyOperation();
  return { success: true, data: result };
} catch (error) {
  console.error('Operation failed:', error);
  return { 
    success: false, 
    error: error.message,
    context: 'VThink 1.0 Error Handling'
  };
}
```

## ğŸš€ **Project Context - VThink 1.0**
This is an enterprise SaaS platform built with React + TypeScript + Supabase featuring:
- **VThink 1.0 Methodology** with CMMI-ML3 compliance
- **Monorepo architecture** with Lerna management
- **Multi-tenant architecture** with company isolation
- **5-tier role system** (EMPLOYEE â†’ MANAGER â†’ ADMIN â†’ OWNER â†’ SUPER_ADMIN)
- **AI integration ready** (OpenAI, Firecrawl, Knotie)
- **Dynamic plan management** with custom limits
- **Comprehensive testing utilities** with CI/CD automation

## ğŸ“‹ **Session Protocol - OBLIGATORIO**

### **Al iniciar cada sesiÃ³n:**
```typescript
// PROTOCOLO DE INICIO AUTOMÃTICO - VThink 1.0
const sessionInfo = {
  fecha: "DD-MM-YYYY",
  participante: "Nombre del participante", 
  rol: "Rol en el proyecto",
  contexto: "PropÃ³sito de la sesiÃ³n"
};

// VALIDACIÃ“N OBLIGATORIA
if (!sessionInfo.fecha || !sessionInfo.participante) {
  throw new Error("InformaciÃ³n de sesiÃ³n incompleta");
}
```

### **Preguntas EstÃ¡ndar de Inicio:**
1. **Â¿CuÃ¡l es la fecha actual?** (formato DD-MM-YYYY)
2. **Â¿QuiÃ©n eres?** (nombre y rol en el proyecto)
3. **Â¿CuÃ¡l es el propÃ³sito de esta sesiÃ³n?** (contexto general)

## ğŸ—ï¸ **Monorepo Structure - VThink 1.0**

### **File Organization:**
```
src/
â”œâ”€â”€ apps/                    # Independent applications
â”‚   â”œâ”€â”€ admin/              # Admin panel app
â”‚   â”œâ”€â”€ dashboard/          # Main dashboard app
â”‚   â”œâ”€â”€ ai-chat/            # AI chat application
â”‚   â”œâ”€â”€ helpdesk/           # Support system app
â”‚   â””â”€â”€ login/              # Authentication app
â”œâ”€â”€ shared/                 # Shared components & utilities
â”‚   â”œâ”€â”€ components/         # Reusable components
â”‚   â”œâ”€â”€ hooks/              # Custom hooks
â”‚   â”œâ”€â”€ utils/              # Utility functions
â”‚   â”œâ”€â”€ types/              # Type definitions
â”‚   â””â”€â”€ services/           # Shared services
â”œâ”€â”€ integrations/           # External integrations
â”‚   â”œâ”€â”€ supabase/           # Database integration
â”‚   â”œâ”€â”€ medusa/             # E-commerce integration
â”‚   â”œâ”€â”€ strapi/             # CMS integration
â”‚   â””â”€â”€ component-registry.json
â”œâ”€â”€ common/                 # Common patterns & configurations
â”œâ”€â”€ specialized/            # Specialized modules
â””â”€â”€ modules/                # Business logic modules
```

### **Import Patterns:**
```typescript
// âœ… Correct: Use aliases for monorepo imports
import { Component } from '@/shared/components';
import { useAuth } from '@/shared/hooks';
import { apiClient } from '@/shared/services';

// âŒ Incorrect: Relative imports across apps
import { Component } from '../../../shared/components';
```

## ğŸ”’ **Security Requirements - Multi-tenant**

### **ALWAYS Filter by company_id:**
```typescript
// âœ… Correct: Company-scoped query
const data = await supabase
  .from('users')
  .select('*')
  .eq('company_id', user.company_id);

// âŒ SECURITY VIOLATION: Query without company_id
const data = await supabase.from('users').select('*');
```

### **Role-based Access Control:**
```typescript
// âœ… Correct: Check permissions before access
if (hasPermission('ADMIN')) {
  // Admin functionality
}

// âœ… Correct: Use FeatureGate component
<FeatureGate permission="ADMIN">
  <AdminPanel />
</FeatureGate>
```

### **RLS Policies Validation:**
```typescript
// âœ… Always validate RLS policies
const { data, error } = await supabase
  .from('companies')
  .select('*')
  .eq('company_id', user.company_id);

if (error) {
  console.error('RLS policy violation:', error);
  throw new Error('Access denied');
}
```

## ğŸ¨ **Code Standards - TypeScript Strict**

### **TypeScript Patterns:**
```typescript
// âœ… Strict typing - no 'any'
interface UserProps {
  user: User;
  onAction: (action: UserAction) => void;
  isLoading?: boolean;
}

// âœ… Enum types for fixed values
enum UserRole {
  EMPLOYEE = 'EMPLOYEE',
  MANAGER = 'MANAGER',
  ADMIN = 'ADMIN',
  OWNER = 'OWNER',
  SUPER_ADMIN = 'SUPER_ADMIN'
}

// âœ… Database types from Supabase
import type { Database } from '@/integrations/supabase/types';
type User = Database['public']['Tables']['users']['Row'];
```

### **React Patterns:**
```typescript
// âœ… Functional components with hooks
const UserComponent: React.FC<UserProps> = ({ user, onAction, isLoading }) => {
  const { hasPermission } = useAuth();
  
  if (!hasPermission('ADMIN')) {
    return <Unauthorized />;
  }
  
  return (
    <div className="p-4">
      {/* Component content */}
    </div>
  );
};

// âœ… Use React.memo for performance
export default React.memo(UserComponent);
```

## ğŸ§ª **Testing Requirements - VThink 1.0**

### **Multi-tenant Testing:**
```typescript
// âœ… Test company isolation
describe('Multi-tenant Security', () => {
  it('should not access cross-company data', async () => {
    const company1User = createTestUser({ company_id: 'company1' });
    const company2Data = await fetchCompanyData(company1User, 'company2');
    
    expect(company2Data).toBeNull();
  });
});
```

### **Role-based Testing:**
```typescript
// âœ… Test role permissions
describe('Role-based Access', () => {
  it('should deny access to unauthorized roles', () => {
    const employee = createTestUser({ role: 'EMPLOYEE' });
    const canAccessAdmin = hasPermission(employee, 'ADMIN');
    
    expect(canAccessAdmin).toBe(false);
  });
});
```

## ğŸš€ **CI/CD Integration - VThink 1.0**

### **Pre-commit Validations:**
```bash
# âœ… VThink 1.0 validations
npm run validate:vtk
npm run test:multi-tenant
npm run lint:accents
npm run lint:spelling
npm run quality-check
```

### **Monorepo Commands:**
```bash
# âœ… Lerna commands for monorepo
npx lerna run build
npx lerna run test
npx lerna run lint
npx lerna publish
```

## ğŸ“š **Documentation Standards - VThink 1.0**

### **Component Documentation:**
```typescript
/**
 * @component UserManagement
 * @description Manages user operations with multi-tenant security
 * @requires ADMIN permission
 * @example
 * <UserManagement 
 *   companyId="company123"
 *   onUserUpdate={handleUpdate}
 * />
 */
```

### **VThink Documentation:**
```markdown
# Component: UserManagement

## VThink 1.0 Compliance
- âœ… Multi-tenant isolation
- âœ… Role-based access control
- âœ… CMMI-ML3 standards
- âœ… Performance optimization

## Security Considerations
- Company_id filtering required
- RLS policies enforced
- Audit logging implemented
```

## ğŸ¯ **Performance Guidelines**

### **React Query Patterns:**
```typescript
// âœ… Optimized queries with company isolation
const { data, isLoading, error } = useQuery({
  queryKey: ['users', user?.company_id],
  queryFn: () => fetchUsers(user?.company_id),
  enabled: !!user?.company_id,
  staleTime: 5 * 60 * 1000, // 5 minutes
});
```

### **Bundle Optimization:**
```typescript
// âœ… Lazy load route components
const AdminPanel = lazy(() => import('@/apps/admin/AdminPanel'));

// âœ… Code splitting for large features
const UserManagement = lazy(() => import('@/shared/components/UserManagement'));
```

## ğŸ”§ **Development Workflow - VThink 1.0**

### **Task Management:**
```typescript
// âœ… Use VThink task templates
const task = {
  level: 1, // 1=Quick fix, 2-4=Feature, 5=Architecture
  complexity: 'low',
  vtkCompliance: true,
  securityReview: true,
  testingRequired: true
};
```

### **Git Workflow:**
```bash
# âœ… VThink 1.0 commit format
git commit -m "feat(admin): add user management with multi-tenant security

- Implements company_id filtering
- Adds role-based access control
- Includes comprehensive testing
- VThink 1.0 compliant"
```

## ğŸ›¡ï¸ **Anti-Patterns to Avoid**

### **Security Violations:**
```typescript
// âŒ NEVER do this:
const users = await supabase.from('users').select('*'); // No company_id filter
const adminData = await fetchAdminData(); // No permission check
```

### **Monorepo Violations:**
```typescript
// âŒ NEVER do this:
import { Component } from '../../../shared/components'; // Relative import
const data = await fetchData(); // No error handling
```

### **VThink Violations:**
```typescript
// âŒ NEVER do this:
// Missing session protocol
// No documentation
// No testing
// No security review
```

## ğŸ¯ **Role-Specific Development**

### **SUPER_ADMIN Features:**
```typescript
// âœ… Cross-company administration
if (hasPermission('SUPER_ADMIN')) {
  const allCompanies = await fetchAllCompanies();
  // Cross-company operations allowed
}
```

### **Company Features:**
```typescript
// âœ… Company-scoped data only
const companyData = await fetchCompanyData(user.company_id);
// Always filter by company_id
```

## ğŸ“Š **Quality Metrics - VThink 1.0**

### **Required Metrics:**
- **Security**: 100% multi-tenant isolation
- **Performance**: <2s load time for main features
- **Testing**: >90% coverage for critical paths
- **Documentation**: 100% VThink 1.0 compliance
- **Accessibility**: WCAG 2.1 AA compliance

### **Monitoring:**
```typescript
// âœ… Performance monitoring
const metrics = {
  loadTime: performance.now(),
  securityChecks: true,
  vtkCompliance: true,
  userExperience: 'excellent'
};
```

## ğŸ”„ **Session Management - VThink 1.0**

### **Context Preservation:**
```typescript
// âœ… Session context management
const sessionContext = {
  userId: user.id,
  companyId: user.company_id,
  role: user.role,
  permissions: user.permissions,
  lastActivity: new Date()
};
```

### **Memory Bank Integration:**
```typescript
// âœ… Memory bank for context
const memoryBank = {
  essential: loadEssentialContext(),
  common: loadCommonContext(),
  specialized: loadSpecializedContext()
};
```

## ğŸ› ï¸ **Development Tools & File Management**

### **File Organization Commands:**
```bash
# âœ… Quick file operations
Ctrl+P: Quick file finder
Ctrl+Shift+F: Global search
Ctrl+Shift+E: Explorer focus
Ctrl+B: Toggle sidebar
Ctrl+J: Toggle terminal
```

### **Code Navigation:**
```bash
# âœ… Navigation shortcuts
F12: Go to definition
Alt+F12: Peek definition
Shift+F12: Find all references
Ctrl+T: Go to symbol
Ctrl+Shift+O: Go to symbol in file
```

### **Multi-cursor & Selection:**
```bash
# âœ… Multi-cursor operations
Alt+Click: Add cursor
Ctrl+Alt+Up/Down: Add cursor above/below
Ctrl+D: Select next occurrence
Ctrl+Shift+L: Select all occurrences
Alt+Shift+I: Insert cursor at end of each line
```

### **Code Folding & Structure:**
```bash
# âœ… Code organization
Ctrl+Shift+[: Fold region
Ctrl+Shift+]: Unfold region
Ctrl+K Ctrl+0: Fold all
Ctrl+K Ctrl+J: Unfold all
```

### **Git Integration:**
```bash
# âœ… Git operations
Ctrl+Shift+G: Git panel
Ctrl+Shift+P "Git: Commit": Quick commit
Ctrl+Shift+P "Git: Push": Push changes
Ctrl+Shift+P "Git: Pull": Pull changes
```

### **Terminal & Debug:**
```bash
# âœ… Development workflow
Ctrl+`: Toggle terminal
F5: Start debugging
Ctrl+Shift+F5: Restart debugging
F9: Toggle breakpoint
Ctrl+Shift+F9: Clear all breakpoints
```

### **Extensions & Tools:**
```json
{
  "recommendedExtensions": [
    "ms-vscode.vscode-typescript-next",
    "bradlc.vscode-tailwindcss",
    "esbenp.prettier-vscode",
    "ms-vscode.vscode-eslint",
    "ms-vscode.vscode-json",
    "ms-vscode.vscode-css-peek",
    "formulahendry.auto-rename-tag",
    "christian-kohler.path-intellisense"
  ]
}
```

### **Workspace Settings:**
```json
{
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true,
    "source.organizeImports": true
  },
  "typescript.preferences.importModuleSpecifier": "relative",
  "typescript.suggest.autoImports": true,
  "emmet.includeLanguages": {
    "typescript": "html",
    "typescriptreact": "html"
  },
  "testing.automaticallyOpenPeekView": "never",
  "testing.followRunningTest": false,
  "testing.gutterEnabled": true,
  "testing.openTesting": "openExplorerOnError"
}
```

### **Advanced Testing Configuration:**
```json
{
  "jest.autoRun": {
    "watch": false,
    "onSave": "test-file"
  },
  "jest.showCoverageOnLoad": true,
  "jest.coverageFormatter": "DefaultFormatter",
  "jest.coverageColors": {
    "covered": "#4caf50",
    "uncovered": "#f44336",
    "partially-covered": "#ff9800"
  }
}
```

### **Performance Monitoring Setup:**
```typescript
// âœ… Performance monitoring configuration
const performanceConfig = {
  metrics: {
    loadTime: true,
    memoryUsage: true,
    apiResponseTime: true,
    bundleSize: true
  },
  thresholds: {
    maxLoadTime: 2000, // 2 seconds
    maxMemoryUsage: 50 * 1024 * 1024, // 50MB
    maxApiResponseTime: 1000 // 1 second
  },
  reporting: {
    console: true,
    analytics: true,
    alerts: true
  }
};
```

### **Debugging Configuration:**
```json
{
  "debug.console.fontSize": 12,
  "debug.console.lineHeight": 18,
  "debug.inlineValues": true,
  "debug.showBreakpointsInOverviewRuler": true,
  "debug.showInlineBreakpointCandidates": true,
  "debug.toolBarLocation": "docked"
}
```

## ğŸ“ **File Management & Migration Patterns**

### **Repository Structure Management:**
```bash
# âœ… Clean repository structure
new-repo/           # Main development repository
â”œâ”€â”€ src/            # Source code
â”œâ”€â”€ docs/           # Documentation
â”œâ”€â”€ tests/          # Test files
â”œâ”€â”€ dev-tools/      # Development tools
â””â”€â”€ memory-bank/    # Context management

repo_archive/       # Archived content
â”œâ”€â”€ backups/        # Backup files
â”œâ”€â”€ archives/       # Historical content
â”œâ”€â”€ legacy/         # Legacy code
â””â”€â”€ deprecated/     # Deprecated features
```

### **Migration Workflow:**
```typescript
// âœ… Migration validation
const migrationChecklist = {
  sourceValidation: true,
  targetStructure: true,
  dependencyCheck: true,
  securityReview: true,
  testingRequired: true,
  documentationUpdate: true
};
```

### **File Organization Commands:**
```bash
# âœ… Repository cleanup commands
npm run clean:repo          # Remove temporary files
npm run validate:structure  # Validate repository structure
npm run migrate:content     # Migrate content to new structure
npm run backup:before       # Create backup before changes
```

---

**Follow these rules to maintain VThink 1.0 compliance, security, and quality in the codebase.**

# AI Build Policy â€” VibeThink Orchestrator

- NPM-only (no pnpm/yarn/bun)
- Builds de dashboard: ejecutar SIEMPRE vÃ­a script root
  - `npm run build:dashboard` â†’ internamente: `cd apps/dashboard && npx --no-install next build`
- No ejecutar `next build` directamente en apps si no es vÃ­a script root
- Dependencias solo en root; apps sin node_modules